function disconnect(){if(instance)return instance.invokeMethodAsync("Disconnect")}function runGameTimer(){var n=setInterval(()=>{tRemaining--;let t=Math.floor(tRemaining/60),i=(tRemaining%60).toString().padStart(2,"0");document.getElementById("timer").innerText=`${t}:${i}`;tRemaining===0&&clearInterval(n)},1e3)}function triggerGoal(){let n=document.getElementById("overlayText");n.innerText="GO";n.style.display="unset";setInterval(()=>{n.innerText+="O"},100)}function pushVector(n,t){console.log(n);console.log(t);instance&&canSend&&(instance.invokeMethodAsync("PushVector",n,t),canSend=!1,setTimeout(()=>{canSend=!0},200))}function drawDot(n,t,i,r){n.clearRect(0,0,clientCanvas.width,clientCanvas.height);n.fillStyle="rgba(0, 255, 0, 1)";n.beginPath();n.arc(t,i,r,0,Math.PI*2,!0);n.closePath();n.fill();n.strokeStyle="rgba(0, 255, 0, 1)";n.beginPath();n.moveTo(t,i);n.lineTo(canvasCenter.x,canvasCenter.y);n.closePath();n.stroke();vectorX=(t-canvasCenter.x)/clientCanvas.width;vectorY=(i-canvasCenter.y)/clientCanvas.height}function sketchpad_mouseDown(){mouseDown=1;drawDot(ctx,mouseX,mouseY,8)}function sketchpad_mouseUp(){mouseDown=0;ctx.clearRect(0,0,clientCanvas.width,clientCanvas.height);vectorX&&vectorY&&(pushVector(vectorX,vectorY),vectorX=null,vectorY=null)}function sketchpad_mouseMove(n){getMousePos(n);mouseDown===1&&drawDot(ctx,mouseX,mouseY,8)}function getMousePos(n){n||(n=event);mouseX=n.layerX;mouseY=n.layerY}function sketchpad_touchStart(){getTouchPos();drawDot(ctx,touchX,touchY,8);event.preventDefault()}function sketchpad_touchEnd(){ctx.clearRect(0,0,clientCanvas.width,clientCanvas.height);vectorX&&vectorY&&(pushVector(vectorX,vectorY),vectorX=null,vectorY=null)}function sketchpad_touchMove(n){getTouchPos(n);drawDot(ctx,touchX,touchY,8);event.preventDefault()}function getTouchPos(n){if(n||(n=event),n.touches&&n.touches.length===1){var t=n.touches[0],i=clientCanvas.getBoundingClientRect();touchX=t.pageX-i.left;touchY=t.pageY-i.top}}var instance,tRemaining,clientCanvas,canvasCenter,ctx,canSend,mouseX,mouseY,mouseDown,vectorX,vectorY;window.createref=n=>{instance=n};window.onunload=disconnect;var engine,ball,leftGoal,rightGoal,playerDict={},orangeScore=0,blueScore=0,acceptPlayerInput=!1;window.gamestart=(n,t,i)=>{var w=document.getElementById("gameCanvas"),e=window.innerWidth/2,h=window.innerHeight/2,v=Matter.Engine,y=Matter.Render,o=Matter.World,r=Matter.Bodies,c,u,f,s,p;engine=v.create();c=y.create({canvas:w,engine:engine,options:{height:window.innerHeight,width:window.innerWidth,wireframes:!1,showVelocity:!0}});engine.world.gravity.y=0;o.add(engine.world,[r.rectangle(e,0,window.innerWidth,1,{isStatic:!0}),r.rectangle(e,window.innerHeight,window.innerWidth,1,{isStatic:!0}),r.rectangle(0,h,1,window.innerHeight,{isStatic:!0}),r.rectangle(window.innerWidth,h,1,window.innerHeight,{isStatic:!0})]);u=window.innerHeight/8;f=window.innerWidth/8;o.add(engine.world,[r.rectangle(0,u*3,f,2,{isStatic:!0,render:{fillStyle:"white"}}),r.rectangle(0,u*5,f,2,{isStatic:!0,render:{fillStyle:"white"}}),r.rectangle(window.innerWidth,u*3,f,2,{isStatic:!0,render:{fillStyle:"white"}}),r.rectangle(window.innerWidth,u*5,f,2,{isStatic:!0,render:{fillStyle:"white"}})]);leftGoal=r.rectangle(0,4*u+1,f,u*2,{isStatic:!0,render:{fillStyle:"#f80a"},collisionFilter:{mask:-2,group:1}});rightGoal=r.rectangle(window.innerWidth,4*u+1,f,u*2,{isStatic:!0,render:{fillStyle:"#38ca"},collisionFilter:{mask:-2,group:1}});o.add(engine.world,[leftGoal,rightGoal]);ball=r.circle(e,h,35,{render:{fillStyle:"white"},restitution:.7});o.add(engine.world,[ball]);var b=JSON.parse(n),l=1,a=1,k=window.innerHeight/(t+1),d=window.innerHeight/(i+1);b.forEach(n=>{var t;if(n.Team==1){let n=1/2*e,i=k*l;t=r.polygon(n,i,2+l,60,{render:{fillStyle:"orange"},angle:3.14,restitution:1});l++}else if(n.Team==2){let n=3/2*e,i=d*a;t=r.polygon(n,i,2+a,60,{render:{fillStyle:"teal"},restitution:1});a++}o.add(engine.world,t);playerDict[n.Id]=t});v.run(engine);y.run(c);Matter.Events.on(c,"afterRender",()=>{let t=ball.position.x,n=ball.position.y;t<f*.5&&n<u*5&&n>u*3?(orangeScore++,document.getElementById("scoreRed").innerText=orangeScore):t>f*7.5&&n<u*5&&n>u*3&&(blueScore++,document.getElementById("scoreBlue").innerText=blueScore)});s=2;p=setInterval(()=>{s!=0?document.getElementById("overlayText").innerText=s:(document.getElementById("overlayText").innerText="Go!",clearInterval(p),setTimeout(()=>{document.getElementById("overlayText").style.display="none",acceptPlayerInput=!0,runGameTimer()},1200)),s--},1200)};tRemaining=180;window.applyplayerforce=(n,t,i)=>{if(acceptPlayerInput){let r=playerDict[n];Matter.Body.applyForce(r,r.position,{x:t,y:i})}};window.fullscreen=()=>{document.getElementById("client").requestFullscreen()};canvasCenter={x:0,y:0};window.initcontrols=()=>{clientCanvas=document.getElementById("controlsCanvas");var n=Math.min(window.innerHeight,window.innerWidth,700);clientCanvas.width=n;clientCanvas.height=n;canvasCenter={x:n/2,y:n/2};clientCanvas.getContext&&(ctx=clientCanvas.getContext("2d"));ctx&&(clientCanvas.addEventListener("mousedown",sketchpad_mouseDown,!1),clientCanvas.addEventListener("mousemove",sketchpad_mouseMove,!1),window.addEventListener("mouseup",sketchpad_mouseUp,!1),clientCanvas.addEventListener("touchstart",sketchpad_touchStart,!1),clientCanvas.addEventListener("touchend",sketchpad_touchEnd,!1),clientCanvas.addEventListener("touchmove",sketchpad_touchMove,!1))};canSend=!0;